<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Family Organizer</title>
    <style>
        :root {
            --primary: #1A5F7A;
            --primary-light: #2B7A9B;
            --primary-dark: #114356;
            --accent: #FF8B3D;
            --accent-light: #FFB26B;
            --success: #22C55E;
            --warning: #F59E0B;
            --danger: #EF4444;
            --bg-main: #F8FAFC;
            --bg-card: #FFFFFF;
            --bg-secondary: #F1F5F9;
            --text-primary: #0F172A;
            --text-secondary: #64748B;
            --text-tertiary: #94A3B8;
            --border: #E2E8F0;
            --shadow: 0 4px 6px -1px rgba(15, 23, 42, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(15, 23, 42, 0.1);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-main);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
        }
        .container { max-width: 1600px; margin: 0 auto; }
        
        header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            padding: 2rem;
            box-shadow: var(--shadow-lg);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        h1 { font-size: 2rem; font-weight: 700; color: white; margin-bottom: 0.5rem; }
        .subtitle { color: rgba(255, 255, 255, 0.8); font-size: 0.95rem; }
        .score-display {
            position: absolute;
            top: 2rem;
            right: 2rem;
            background: white;
            color: var(--primary);
            padding: 0.75rem 1.5rem;
            border-radius: 12px;
            font-weight: 700;
            font-size: 1.25rem;
            box-shadow: var(--shadow-lg);
        }
        .score-label { font-size: 0.7rem; opacity: 0.7; display: block; text-transform: uppercase; }
        
        .nav-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 1rem;
            padding: 1.5rem 2rem;
            background: white;
            border-bottom: 1px solid var(--border);
        }
        .nav-btn {
            background: var(--bg-secondary);
            border: 2px solid transparent;
            color: var(--text-primary);
            padding: 0.875rem;
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }
        .nav-btn:hover { background: var(--bg-main); border-color: var(--primary); }
        .nav-btn.active { background: var(--primary); color: white; }
        
        .content-section { display: none; padding: 2rem; }
        .content-section.active { display: block; }
        .card {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 2rem;
            box-shadow: var(--shadow);
            margin-bottom: 1.5rem;
            border: 1px solid var(--border);
        }
        h2 { font-size: 1.5rem; font-weight: 700; margin-bottom: 1.5rem; }
        h3 { font-size: 1.2rem; font-weight: 600; margin-bottom: 1rem; color: var(--primary); }
        
        .input-group { display: flex; gap: 0.75rem; margin-bottom: 1.5rem; flex-wrap: wrap; }
        input, textarea, select {
            flex: 1;
            min-width: 160px;
            padding: 0.75rem 1rem;
            border: 2px solid var(--border);
            border-radius: 10px;
            font-family: inherit;
            font-size: 0.95rem;
            transition: all 0.2s;
        }
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(26, 95, 122, 0.1);
        }
        textarea { min-height: 80px; resize: vertical; }
        
        .btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 10px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            white-space: nowrap;
        }
        .btn:hover { background: var(--primary-light); transform: translateY(-1px); }
        .btn-accent { background: var(--accent); }
        .btn-accent:hover { background: var(--accent-light); }
        
        /* Dashboard Grid */
        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .dashboard-section {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
        }
        
        .todo-list, .shopping-list, .routine-list { list-style: none; }
        .todo-item, .shopping-item, .routine-item {
            background: var(--bg-card);
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 0.75rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
            transition: all 0.2s;
        }
        .todo-item:hover, .shopping-item:hover, .routine-item:hover {
            border-color: var(--primary);
            box-shadow: var(--shadow);
            transform: translateX(4px);
        }
        .todo-item.completed, .shopping-item.completed, .routine-item.completed {
            background: var(--bg-secondary);
            opacity: 0.6;
        }
        .todo-item.priority-high { border-left: 4px solid var(--danger); }
        .todo-item.priority-medium { border-left: 4px solid var(--warning); }
        .todo-item.priority-low { border-left: 4px solid #3B82F6; }
        
        .todo-text, .shopping-text, .routine-text { flex: 1; font-size: 0.95rem; font-weight: 500; }
        .todo-item.completed .todo-text,
        .shopping-item.completed .shopping-text,
        .routine-item.completed .routine-text {
            text-decoration: line-through;
            color: var(--text-tertiary);
        }
        
        .task-badge {
            padding: 0.2rem 0.6rem;
            border-radius: 6px;
            font-size: 0.7rem;
            font-weight: 600;
            margin-right: 0.5rem;
        }
        .badge-assignee { background: var(--primary); color: white; }
        .badge-priority-high { background: rgba(239, 68, 68, 0.1); color: var(--danger); border: 1px solid var(--danger); }
        .badge-priority-medium { background: rgba(245, 158, 11, 0.1); color: var(--warning); border: 1px solid var(--warning); }
        .badge-priority-low { background: rgba(59, 130, 246, 0.1); color: #3B82F6; border: 1px solid #3B82F6; }
        
        .btn-complete {
            background: var(--success);
            color: white;
            border: none;
            padding: 0.4rem 0.8rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.8rem;
            transition: all 0.2s;
        }
        .btn-complete:hover { background: #16A34A; }
        .btn-complete.completed { background: var(--text-tertiary); cursor: default; }
        
        .leaderboard-item {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 1rem 1.5rem;
            margin-bottom: 0.75rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .leaderboard-rank { font-size: 1.5rem; font-weight: 700; color: var(--accent); width: 40px; }
        .leaderboard-name { flex: 1; font-size: 1.1rem; font-weight: 600; }
        .leaderboard-score { font-size: 1.3rem; font-weight: 700; color: var(--primary); }
        .leaderboard-item.first {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 215, 0, 0.1));
            border: 2px solid #FFD700;
        }
        
        .today-events {
            background: var(--bg-secondary);
            border-left: 4px solid var(--accent);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 0.75rem;
        }
        .event-title-small { font-size: 1rem; font-weight: 600; color: var(--primary); margin-bottom: 0.25rem; }
        .event-time-small { font-size: 0.85rem; color: var(--text-secondary); }
        
        .calendar-event {
            background: var(--bg-secondary);
            border-left: 4px solid var(--accent);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }
        .event-title { font-size: 1.2rem; font-weight: 600; color: var(--primary); margin-bottom: 0.5rem; }
        .event-datetime { font-size: 0.95rem; color: var(--text-secondary); margin-bottom: 0.5rem; }
        .event-weather {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.4rem 1rem;
            background: rgba(255, 139, 61, 0.1);
            border-radius: 8px;
            font-size: 0.85rem;
            margin-top: 0.5rem;
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 3px;
        }
        .calendar-day {
            background: white;
            border: 2px solid var(--border);
            border-radius: 8px;
            min-height: 90px;
            padding: 4px;
            transition: all 0.2s;
            overflow: hidden;
        }
        .calendar-day:hover { border-color: var(--primary); box-shadow: var(--shadow); }
        .calendar-day.other-month { opacity: 0.3; }
        .calendar-day.today { border-color: var(--accent); border-width: 3px; background: rgba(255, 139, 61, 0.05); }
        .calendar-day-number { font-weight: 700; font-size: 0.9rem; margin-bottom: 3px; }
        .calendar-weather-small { font-size: 0.65rem; color: var(--text-secondary); margin-bottom: 2px; }
        .calendar-event-dot {
            background: var(--primary);
            color: white;
            padding: 2px 4px;
            border-radius: 3px;
            font-size: 0.6rem;
            margin-bottom: 2px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            display: block;
        }
        
        .birthday-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1rem;
        }
        .birthday-card {
            background: linear-gradient(135deg, var(--accent), var(--accent-light));
            color: white;
            border-radius: 16px;
            padding: 2rem;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        .birthday-card::before {
            content: 'üéÇ';
            position: absolute;
            top: -20px;
            right: -20px;
            font-size: 5rem;
            opacity: 0.2;
        }
        .birthday-countdown { font-size: 2rem; font-weight: 700; margin-bottom: 0.5rem; z-index: 1; position: relative; }
        .birthday-name { font-size: 1.4rem; font-weight: 700; margin-bottom: 0.5rem; z-index: 1; position: relative; }
        .birthday-date { font-size: 1rem; opacity: 0.9; z-index: 1; position: relative; }
        
        .points-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, var(--accent), var(--accent-light));
            color: white;
            padding: 2rem 3rem;
            border-radius: 20px;
            font-size: 2rem;
            font-weight: 700;
            box-shadow: var(--shadow-lg);
            animation: pointsEarned 1.5s ease-out forwards;
            z-index: 1000;
        }
        @keyframes pointsEarned {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
            50% { opacity: 1; transform: translate(-50%, -50%) scale(1.2); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(1); }
        }
        
        .loading { text-align: center; padding: 2rem; color: var(--text-tertiary); }
        
        /* Day Details Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        .modal-overlay.active {
            display: flex;
        }
        .modal-content {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 2.5rem;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: var(--shadow-xl);
            position: relative;
            animation: modalSlideIn 0.3s ease-out;
        }
        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .modal-close {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
            background: var(--bg-secondary);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 1.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            color: var(--text-primary);
        }
        .modal-close:hover {
            background: var(--danger);
            color: white;
            transform: rotate(90deg);
        }
        .modal-date {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }
        .modal-day {
            font-size: 1.1rem;
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
        }
        .modal-section {
            margin-bottom: 2rem;
        }
        .modal-section-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .modal-weather-large {
            background: var(--bg-secondary);
            padding: 1.5rem;
            border-radius: 12px;
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        .modal-weather-icon {
            font-size: 3rem;
        }
        .modal-weather-temp {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary);
        }
        .modal-weather-desc {
            font-size: 1rem;
            color: var(--text-secondary);
            text-transform: capitalize;
        }
        .modal-event-item {
            background: var(--bg-secondary);
            padding: 1rem;
            border-radius: 12px;
            margin-bottom: 0.75rem;
            border-left: 4px solid var(--accent);
        }
        .modal-event-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }
        .modal-event-time {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }
        .modal-event-desc {
            font-size: 0.9rem;
            color: var(--text-primary);
        }
        .modal-birthday-item {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 215, 0, 0.1));
            padding: 1rem;
            border-radius: 12px;
            margin-bottom: 0.75rem;
            border-left: 4px solid #FFD700;
        }
        .modal-birthday-name {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }
        .modal-birthday-age {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }
        .modal-empty {
            text-align: center;
            padding: 2rem;
            color: var(--text-tertiary);
            font-style: italic;
        }
        
        @media (max-width: 1024px) {
            .dashboard-grid { grid-template-columns: 1fr; }
        }
        
        @media (max-width: 768px) {
            header { padding: 1.5rem 1rem; }
            h1 { font-size: 1.5rem; }
            .score-display { position: static; margin-top: 1rem; display: inline-block; }
            .nav-buttons { grid-template-columns: repeat(2, 1fr); padding: 1rem; }
            .content-section { padding: 1rem; }
            .card { padding: 1.5rem; }
            .calendar-day { min-height: 70px; padding: 3px; }
            .calendar-day-number { font-size: 0.8rem; }
            .calendar-event-dot { font-size: 0.55rem; padding: 1px 3px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Family Organizer</h1>
            <div class="subtitle">Rob, Jessie, Spencer & Grainger</div>
            <div class="score-display">
                <span class="score-label">FAMILY POINTS</span>
                <span id="scoreValue">0</span>
            </div>
        </header>

        <div class="nav-buttons">
            <button class="nav-btn active" data-section="dashboard">üè† Dashboard</button>
            <button class="nav-btn" data-section="leaderboard">üèÜ Leaderboard</button>
            <button class="nav-btn" data-section="shopping">üõí Shopping</button>
            <button class="nav-btn" data-section="calendar">üìÖ Calendar</button>
            <button class="nav-btn" data-section="routines">üë∂ Routines</button>
            <button class="nav-btn" data-section="birthdays">üéÇ Birthdays</button>
        </div>

        <!-- Dashboard -->
        <div class="content-section active" id="dashboard">
            <div id="birthdayAlert" style="display: none; background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 215, 0, 0.1)); border: 2px solid #FFD700; border-radius: 16px; padding: 1.5rem; margin-bottom: 1.5rem;">
                <h3 style="margin: 0 0 0.5rem 0; color: var(--primary);">üéÇ Upcoming Birthday!</h3>
                <div id="birthdayAlertContent"></div>
            </div>
            
            <div class="card">
                <h2>üìÖ Today's Events</h2>
                <div id="todayEvents"></div>
            </div>
            
            <div class="dashboard-grid">
                <div class="dashboard-section">
                    <h3>üìù To-Do List</h3>
                    <div class="input-group">
                        <input type="text" id="newTaskDash" placeholder="New task..." style="min-width: 120px;">
                        <select id="taskAssigneeDash" style="min-width: 100px;">
                            <option value="">Assign...</option>
                            <option value="Rob">Rob</option>
                            <option value="Jessie">Jessie</option>
                            <option value="Spencer">Spencer</option>
                            <option value="Grainger">Grainger</option>
                        </select>
                        <select id="taskPriorityDash" style="min-width: 90px;">
                            <option value="medium">Medium</option>
                            <option value="high">High</option>
                            <option value="low">Low</option>
                        </select>
                        <select id="taskFrequencyDash" style="min-width: 90px;">
                            <option value="none">Once</option>
                            <option value="daily">Daily</option>
                            <option value="weekly">Weekly</option>
                            <option value="monthly">Monthly</option>
                            <option value="yearly">Yearly</option>
                        </select>
                        <button class="btn btn-accent" onclick="addTaskFromDashboard()">Add</button>
                    </div>
                    <ul class="todo-list" id="todoListDash">
                        <li class="loading">Loading...</li>
                    </ul>
                </div>
                
                <div class="dashboard-section">
                    <h3>üõí Shopping List</h3>
                    <div class="input-group">
                        <input type="text" id="newShoppingItemDash" placeholder="Item to buy...">
                        <button class="btn btn-accent" onclick="addShoppingItemFromDashboard()">Add</button>
                    </div>
                    <ul class="shopping-list" id="shoppingListDash">
                        <li class="loading">Loading...</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Leaderboard -->
        <div class="content-section" id="leaderboard">
            <div class="card">
                <h2>üèÜ Family Leaderboard</h2>
                <div id="leaderboardFull"></div>
            </div>
        </div>

        <!-- Shopping List -->
        <div class="content-section" id="shopping">
            <div class="card">
                <h2>Shopping List</h2>
                <div class="input-group">
                    <input type="text" id="newShoppingItem" placeholder="What do you need to buy?">
                    <button class="btn btn-accent" onclick="addShoppingItem()">Add Item</button>
                </div>
                <ul class="shopping-list" id="shoppingList">
                    <li class="loading">Loading...</li>
                </ul>
            </div>
        </div>

        <!-- Calendar -->
        <div class="content-section" id="calendar">
            <div class="card">
                <h2>Family Calendar</h2>
                
                <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem; justify-content: center;">
                    <button class="btn" id="listViewBtn" onclick="switchCalendarView('list')">üìã List View</button>
                    <button class="btn" id="gridViewBtn" onclick="switchCalendarView('grid')" style="background: var(--bg-secondary); color: var(--text-primary);">üìÖ Month View</button>
                </div>
                
                <div class="input-group">
                    <input type="text" id="eventTitle" placeholder="Event title">
                    <input type="date" id="eventDate">
                    <input type="time" id="eventTime">
                </div>
                <div class="input-group">
                    <textarea id="eventDescription" placeholder="Event description (optional)"></textarea>
                    <button class="btn btn-accent" onclick="addEvent()">Add Event</button>
                </div>
                
                <div id="calendarListView">
                    <div id="calendarEvents"></div>
                </div>
                
                <div id="calendarGridView" style="display: none;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <button class="btn" onclick="changeMonth(-1)">‚óÄ Prev</button>
                        <h3 id="currentMonth" style="margin: 0;">February 2026</h3>
                        <button class="btn" onclick="changeMonth(1)">Next ‚ñ∂</button>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 3px; margin-bottom: 3px;">
                        <div style="text-align: center; font-weight: 600; padding: 8px; font-size: 0.85rem; color: var(--text-secondary);">Sun</div>
                        <div style="text-align: center; font-weight: 600; padding: 8px; font-size: 0.85rem; color: var(--text-secondary);">Mon</div>
                        <div style="text-align: center; font-weight: 600; padding: 8px; font-size: 0.85rem; color: var(--text-secondary);">Tue</div>
                        <div style="text-align: center; font-weight: 600; padding: 8px; font-size: 0.85rem; color: var(--text-secondary);">Wed</div>
                        <div style="text-align: center; font-weight: 600; padding: 8px; font-size: 0.85rem; color: var(--text-secondary);">Thu</div>
                        <div style="text-align: center; font-weight: 600; padding: 8px; font-size: 0.85rem; color: var(--text-secondary);">Fri</div>
                        <div style="text-align: center; font-weight: 600; padding: 8px; font-size: 0.85rem; color: var(--text-secondary);">Sat</div>
                    </div>
                    
                    <div class="calendar-grid" id="calendarGrid"></div>
                </div>
            </div>
        </div>

        <!-- Kids Routines -->
        <div class="content-section" id="routines">
            <div class="card">
                <h2>Spencer's Routine</h2>
                <div class="input-group">
                    <input type="text" id="spencerTask" placeholder="Add task for Spencer">
                    <button class="btn btn-accent" onclick="addRoutine('spencer')">Add Task</button>
                </div>
                <ul class="routine-list" id="spencerRoutine">
                    <li class="loading">Loading...</li>
                </ul>
            </div>

            <div class="card">
                <h2>Grainger's Routine</h2>
                <div class="input-group">
                    <input type="text" id="graingerTask" placeholder="Add task for Grainger">
                    <button class="btn btn-accent" onclick="addRoutine('grainger')">Add Task</button>
                </div>
                <ul class="routine-list" id="graingerRoutine">
                    <li class="loading">Loading...</li>
                </ul>
            </div>
        </div>

        <!-- Birthdays -->
        <div class="content-section" id="birthdays">
            <div class="card">
                <h2>Family Birthdays</h2>
                <div class="input-group">
                    <input type="text" id="birthdayName" placeholder="Name">
                    <input type="text" id="birthdayDate" placeholder="DD/MM/YYYY (e.g., 15/03/1950)">
                    <button class="btn btn-accent" onclick="addBirthday()">Add Birthday</button>
                </div>
                <div class="birthday-grid" id="birthdayList"></div>
            </div>
        </div>
    </div>

    <!-- Day Details Modal -->
    <div class="modal-overlay" id="dayModal" onclick="closeModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <button class="modal-close" onclick="closeDayModal()">√ó</button>
            <div id="modalContent"></div>
        </div>
    </div>

    <script>
        // Configuration
        const API_URL = 'https://script.google.com/macros/s/AKfycbyi7nxiLPP0E_1i3SfwqCFna80RJQCnZY9WhlalLewKVvXEHtlmXo1aYIspKmaj4-pp/exec';
        const WEATHER_API_KEY = 'd505edd7a0bf98a7a28bd658fa664f1d';
        const familyMembers = ['Rob', 'Jessie', 'Spencer', 'Grainger'];
        
        let score = 0;
        let memberScores = {};
        let weatherData = {};
        let currentMonth = new Date();
        let calendarEvents = [];
        
        familyMembers.forEach(member => memberScores[member] = 0);
        
        async function apiCall(action, data = null) {
            try {
                let url = `${API_URL}?action=${action}`;
                if (data) url += `&data=${encodeURIComponent(JSON.stringify(data))}`;
                const response = await fetch(url);
                const result = await response.json();
                if (result.error) {
                    console.error('API Error:', result.error);
                    return null;
                }
                return result;
            } catch (error) {
                console.error('Fetch error:', error);
                return null;
            }
        }
        
        function getWeatherEmoji(condition) {
            const c = condition.toLowerCase();
            if (c.includes('clear')) return '‚òÄÔ∏è';
            if (c.includes('cloud')) return c.includes('few') ? 'üå§Ô∏è' : '‚òÅÔ∏è';
            if (c.includes('rain')) return 'üåßÔ∏è';
            if (c.includes('thunder')) return '‚õàÔ∏è';
            if (c.includes('snow')) return 'üå®Ô∏è';
            if (c.includes('mist') || c.includes('fog')) return 'üå´Ô∏è';
            return 'üå§Ô∏è';
        }
        
        async function fetchWeather() {
            try {
                const location = { lat: -32.9719, lon: 151.6535 }; // Warners Bay
                const url = `https://api.openweathermap.org/data/2.5/forecast?lat=${location.lat}&lon=${location.lon}&appid=${WEATHER_API_KEY}&units=metric`;
                const response = await fetch(url);
                const data = await response.json();
                
                const dailyForecasts = {};
                data.list.forEach(item => {
                    const date = new Date(item.dt * 1000);
                    const dateStr = date.toISOString().split('T')[0];
                    const hour = date.getHours();
                    if (!dailyForecasts[dateStr] || Math.abs(hour - 12) < Math.abs(new Date(dailyForecasts[dateStr].dt * 1000).getHours() - 12)) {
                        dailyForecasts[dateStr] = item;
                    }
                });
                
                weatherData = {};
                Object.keys(dailyForecasts).forEach(dateStr => {
                    const item = dailyForecasts[dateStr];
                    weatherData[dateStr] = {
                        temp: Math.round(item.main.temp),
                        condition: item.weather[0].main,
                        description: item.weather[0].description,
                        emoji: getWeatherEmoji(item.weather[0].main)
                    };
                });
                return weatherData;
            } catch (error) {
                console.error('Weather error:', error);
                return {};
            }
        }
        
        function getWeatherForDate(dateStr) {
            return weatherData[dateStr] || null;
        }
        
        // Navigation
        document.querySelectorAll('.nav-btn').forEach(btn => {
            btn.addEventListener('click', async () => {
                const section = btn.dataset.section;
                document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
                document.getElementById(section).classList.add('active');
                
                if (section === 'calendar' && Object.keys(weatherData).length === 0) {
                    await fetchWeather();
                    loadCalendar();
                }
            });
        });
        
        function updateScore(points, member = null) {
            score += points;
            document.getElementById('scoreValue').textContent = score;
            
            if (member && familyMembers.includes(member)) {
                memberScores[member] = (memberScores[member] || 0) + points;
                updateLeaderboard();
            }
            
            const popup = document.createElement('div');
            popup.className = 'points-popup';
            popup.textContent = `+${points} Points!`;
            document.body.appendChild(popup);
            setTimeout(() => popup.remove(), 1500);
        }
        
        function updateLeaderboard() {
            const leaderboard = document.getElementById('leaderboardFull');
            const sorted = familyMembers
                .map(member => ({ name: member, score: memberScores[member] || 0 }))
                .sort((a, b) => b.score - a.score);
            
            leaderboard.innerHTML = '';
            sorted.forEach((member, index) => {
                const emoji = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : `${index + 1}.`;
                const div = document.createElement('div');
                div.className = `leaderboard-item ${index === 0 ? 'first' : ''}`;
                div.innerHTML = `
                    <div class="leaderboard-rank">${emoji}</div>
                    <div class="leaderboard-name">${member.name}</div>
                    <div class="leaderboard-score">${member.score} pts</div>
                `;
                leaderboard.appendChild(div);
            });
        }
        
        // To-Do Functions
        async function addTask() {
            const input = document.getElementById('newTask');
            const assignee = document.getElementById('taskAssignee').value;
            const priority = document.getElementById('taskPriority').value;
            const task = input.value.trim();
            if (!task) return alert('Please enter a task!');
            await apiCall('addTask', { task, assignee, priority, addedDate: new Date().toISOString() });
            input.value = '';
            document.getElementById('taskAssignee').value = '';
            document.getElementById('taskPriority').value = 'medium';
            loadTasks();
        }
        
        async function addTaskFromDashboard() {
            const input = document.getElementById('newTaskDash');
            const assignee = document.getElementById('taskAssigneeDash').value;
            const priority = document.getElementById('taskPriorityDash').value;
            const frequency = document.getElementById('taskFrequencyDash').value;
            const task = input.value.trim();
            if (!task) return alert('Please enter a task!');
            await apiCall('addTask', { task, assignee, priority, frequency, addedDate: new Date().toISOString() });
            input.value = '';
            document.getElementById('taskAssigneeDash').value = '';
            document.getElementById('taskPriorityDash').value = 'medium';
            document.getElementById('taskFrequencyDash').value = 'none';
            loadTasks();
        }
        
        async function completeTask(index, assignee) {
            await apiCall('completeTask', { index, completedDate: new Date().toISOString(), completedBy: assignee });
            
            const points = 10 + Math.floor(Math.random() * 5) + 1;
            updateScore(points, assignee);
            
            // Save points to Google Sheets
            if (assignee && familyMembers.includes(assignee)) {
                await apiCall('updatePoints', { member: assignee, points: memberScores[assignee] });
            }
            
            loadTasks();
        }
        
        async function loadTasks() {
            const tasks = await apiCall('getTasks');
            if (!tasks) return;
            
            const renderList = (listId) => {
                const list = document.getElementById(listId);
                list.innerHTML = '';
                
                if (tasks.length === 0) {
                    list.innerHTML = '<li class="loading">No tasks yet!</li>';
                    return;
                }
                
                const priorityOrder = { high: 0, medium: 1, low: 2 };
                tasks.sort((a, b) => {
                    if (a.completed !== b.completed) return a.completed ? 1 : -1;
                    return (priorityOrder[a.priority] || 1) - (priorityOrder[b.priority] || 1);
                });
                
                tasks.forEach(task => {
                    const li = document.createElement('li');
                    li.className = `todo-item ${task.completed ? 'completed' : ''} priority-${task.priority || 'medium'}`;
                    
                    const badges = [];
                    if (task.assignee) badges.push(`<span class="task-badge badge-assignee">${task.assignee}</span>`);
                    if (task.priority) {
                        const p = task.priority.charAt(0).toUpperCase() + task.priority.slice(1);
                        badges.push(`<span class="task-badge badge-priority-${task.priority}">${p}</span>`);
                    }
                    
                    li.innerHTML = `
                        <div style="flex: 1;">
                            <div class="todo-text">${task.task}</div>
                            ${badges.length ? `<div style="margin-top: 0.5rem;">${badges.join('')}</div>` : ''}
                        </div>
                        <button class="btn-complete ${task.completed ? 'completed' : ''}" 
                                onclick="completeTask(${task.index}, '${task.assignee || ''}')" 
                                ${task.completed ? 'disabled' : ''}>
                            ${task.completed ? '‚úì' : 'Done'}
                        </button>
                    `;
                    list.appendChild(li);
                });
            };
            
            renderList('todoListDash');
        }
        
        // Shopping Functions
        async function addShoppingItem() {
            const input = document.getElementById('newShoppingItem');
            const item = input.value.trim();
            if (!item) return alert('Please enter an item!');
            await apiCall('addShoppingItem', { item });
            input.value = '';
            loadShopping();
        }
        
        async function addShoppingItemFromDashboard() {
            const input = document.getElementById('newShoppingItemDash');
            const item = input.value.trim();
            if (!item) return alert('Please enter an item!');
            await apiCall('addShoppingItem', { item });
            input.value = '';
            loadShopping();
        }
        
        async function toggleShoppingItem(index) {
            await apiCall('toggleShoppingItem', { index });
            loadShopping();
        }
        
        async function deleteShoppingItem(index) {
            await apiCall('deleteShoppingItem', { index });
            loadShopping();
        }
        
        async function loadShopping() {
            const items = await apiCall('getShopping');
            if (!items) return;
            
            const renderList = (listId) => {
                const list = document.getElementById(listId);
                list.innerHTML = '';
                
                if (items.length === 0) {
                    list.innerHTML = '<li class="loading">No items yet!</li>';
                    return;
                }
                
                items.forEach(item => {
                    const li = document.createElement('li');
                    li.className = `shopping-item ${item.completed ? 'completed' : ''}`;
                    li.innerHTML = `
                        <div class="shopping-text">${item.item}</div>
                        <div style="display: flex; gap: 0.5rem;">
                            <button class="btn-complete ${item.completed ? 'completed' : ''}" 
                                    onclick="toggleShoppingItem(${item.index})">
                                ${item.completed ? '‚úì' : '‚óã'}
                            </button>
                            ${item.completed ? `<button class="btn-complete" style="background: var(--danger);" onclick="deleteShoppingItem(${item.index})">üóëÔ∏è</button>` : ''}
                        </div>
                    `;
                    list.appendChild(li);
                });
            };
            
            renderList('shoppingListDash');
            renderList('shoppingList');
        }
        
        // Calendar Functions
        async function addEvent() {
            const title = document.getElementById('eventTitle').value.trim();
            const date = document.getElementById('eventDate').value;
            const time = document.getElementById('eventTime').value;
            const description = document.getElementById('eventDescription').value.trim();
            
            if (!title || !date) return alert('Please enter title and date!');
            
            await apiCall('addEvent', { title, date, time, description, addedDate: new Date().toISOString() });
            
            document.getElementById('eventTitle').value = '';
            document.getElementById('eventDate').value = '';
            document.getElementById('eventTime').value = '';
            document.getElementById('eventDescription').value = '';
            
            loadCalendar();
            loadTodayEvents();
        }
        
        async function loadTodayEvents() {
            const events = await apiCall('getEvents');
            const birthdays = await apiCall('getBirthdays');
            
            const today = new Date().toISOString().split('T')[0];
            const todayMonth = new Date().getMonth();
            const todayDay = new Date().getDate();
            
            const container = document.getElementById('todayEvents');
            container.innerHTML = '';
            
            let hasItems = false;
            
            // Add calendar events
            if (events) {
                const todayEvents = events.filter(e => e.date && e.date.startsWith(today));
                todayEvents.forEach(event => {
                    hasItems = true;
                    const div = document.createElement('div');
                    div.className = 'today-events';
                    const sourceBadge = event.source === 'calendar' 
                        ? '<span style="background: #34A853; color: white; padding: 2px 6px; border-radius: 4px; font-size: 0.7rem; margin-left: 6px;">üìÖ</span>'
                        : '';
                    div.innerHTML = `
                        <div class="event-title-small">${event.title}${sourceBadge}</div>
                        <div class="event-time-small">${event.time || 'All day'}</div>
                    `;
                    container.appendChild(div);
                });
            }
            
            // Add birthdays
            if (birthdays) {
                const todayBirthdays = birthdays.filter(b => {
                    const bday = new Date(b.date);
                    return bday.getMonth() === todayMonth && bday.getDate() === todayDay;
                });
                
                todayBirthdays.forEach(birthday => {
                    hasItems = true;
                    const age = calculateAge(birthday.date);
                    const div = document.createElement('div');
                    div.className = 'today-events';
                    div.style.borderLeft = '4px solid #FFD700';
                    div.style.background = 'linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(255, 215, 0, 0.05))';
                    div.innerHTML = `
                        <div class="event-title-small">üéÇ ${birthday.name}'s Birthday!</div>
                        <div class="event-time-small">Turning ${age} today</div>
                    `;
                    container.appendChild(div);
                });
            }
            
            if (!hasItems) {
                container.innerHTML = '<div class="loading">No events or birthdays today</div>';
            }
        }
        
        async function loadCalendar() {
            const events = await apiCall('getEvents');
            if (!events) return;
            
            calendarEvents = events;
            
            const container = document.getElementById('calendarEvents');
            container.innerHTML = '';
            
            if (events.length === 0) {
                container.innerHTML = '<div class="loading">No events yet!</div>';
                return;
            }
            
            events.sort((a, b) => new Date(a.date) - new Date(b.date));
            
            events.forEach(event => {
                const dateStr = event.date.split('T')[0];
                const weather = getWeatherForDate(dateStr);
                
                const div = document.createElement('div');
                div.className = 'calendar-event';
                
                let weatherHTML = '';
                if (weather) {
                    weatherHTML = `<div class="event-weather"><span>${weather.emoji}</span><span style="font-weight: 600;">${weather.temp}¬∞C</span><span>${weather.description}</span></div>`;
                }
                
                const sourceBadge = event.source === 'calendar' 
                    ? '<span style="background: #34A853; color: white; padding: 3px 8px; border-radius: 6px; font-size: 0.75rem; margin-left: 8px;">üìÖ Google Calendar</span>'
                    : '';
                
                div.innerHTML = `
                    <div class="event-title">${event.title}${sourceBadge}</div>
                    <div class="event-datetime">üìÖ ${new Date(event.date).toLocaleDateString()}${event.time ? ` at ${event.time}` : ''}</div>
                    ${event.description ? `<div style="margin-top: 0.5rem; color: var(--text-primary);">${event.description}</div>` : ''}
                    ${weatherHTML}
                `;
                container.appendChild(div);
            });
            
            if (document.getElementById('calendarGridView').style.display !== 'none') {
                renderCalendarGrid();
            }
        }
        
        function switchCalendarView(view) {
            const listView = document.getElementById('calendarListView');
            const gridView = document.getElementById('calendarGridView');
            const listBtn = document.getElementById('listViewBtn');
            const gridBtn = document.getElementById('gridViewBtn');
            
            if (view === 'list') {
                listView.style.display = 'block';
                gridView.style.display = 'none';
                listBtn.style.background = 'var(--primary)';
                listBtn.style.color = 'white';
                gridBtn.style.background = 'var(--bg-secondary)';
                gridBtn.style.color = 'var(--text-primary)';
            } else {
                listView.style.display = 'none';
                gridView.style.display = 'block';
                listBtn.style.background = 'var(--bg-secondary)';
                listBtn.style.color = 'var(--text-primary)';
                gridBtn.style.background = 'var(--primary)';
                gridBtn.style.color = 'white';
                renderCalendarGrid();
            }
        }
        
        function changeMonth(direction) {
            currentMonth.setMonth(currentMonth.getMonth() + direction);
            renderCalendarGrid();
        }
        
        function renderCalendarGrid() {
            const year = currentMonth.getFullYear();
            const month = currentMonth.getMonth();
            
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                'July', 'August', 'September', 'October', 'November', 'December'];
            document.getElementById('currentMonth').textContent = `${monthNames[month]} ${year}`;
            
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const daysInPrevMonth = new Date(year, month, 0).getDate();
            
            const today = new Date();
            const isCurrentMonth = today.getMonth() === month && today.getFullYear() === year;
            const todayDate = today.getDate();
            
            const grid = document.getElementById('calendarGrid');
            grid.innerHTML = '';
            
            for (let i = firstDay - 1; i >= 0; i--) {
                const day = daysInPrevMonth - i;
                grid.appendChild(createDayCell(day, true, false));
            }
            
            for (let day = 1; day <= daysInMonth; day++) {
                const isToday = isCurrentMonth && day === todayDate;
                grid.appendChild(createDayCell(day, false, isToday, year, month));
            }
            
            const totalCells = grid.children.length;
            const remainingCells = 42 - totalCells;
            for (let day = 1; day <= remainingCells; day++) {
                grid.appendChild(createDayCell(day, true, false));
            }
        }
        
        function createDayCell(day, isOtherMonth, isToday, year, month) {
            const cell = document.createElement('div');
            cell.className = `calendar-day ${isOtherMonth ? 'other-month' : ''} ${isToday ? 'today' : ''}`;
            
            let html = `<div class="calendar-day-number">${day}</div>`;
            
            if (!isOtherMonth && year !== undefined && month !== undefined) {
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                
                const weather = getWeatherForDate(dateStr);
                if (weather) {
                    html += `<div class="calendar-weather-small">${weather.emoji} ${weather.temp}¬∞</div>`;
                }
                
                const dayEvents = calendarEvents.filter(e => e.date && e.date.startsWith(dateStr));
                dayEvents.slice(0, 3).forEach(event => {
                    html += `<div class="calendar-event-dot" title="${event.title}${event.time ? ' at ' + event.time : ''}">${event.title}</div>`;
                });
                if (dayEvents.length > 3) {
                    html += `<div class="calendar-event-dot" style="background: var(--text-tertiary);">+${dayEvents.length - 3} more</div>`;
                }
                
                // Make clickable
                cell.style.cursor = 'pointer';
                cell.onclick = () => openDayModal(dateStr, day, month, year);
            }
            
            cell.innerHTML = html;
            return cell;
        }
        
        async function openDayModal(dateStr, day, month, year) {
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                'July', 'August', 'September', 'October', 'November', 'December'];
            const dayNames = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            
            const date = new Date(year, month, day);
            const dayName = dayNames[date.getDay()];
            const formattedDate = `${monthNames[month]} ${day}, ${year}`;
            
            // Get weather
            const weather = getWeatherForDate(dateStr);
            
            // Get events
            const dayEvents = calendarEvents.filter(e => e.date && e.date.startsWith(dateStr));
            
            // Get birthdays
            const birthdays = await apiCall('getBirthdays');
            const dayBirthdays = birthdays ? birthdays.filter(b => {
                const bday = new Date(b.date);
                return bday.getMonth() === month && bday.getDate() === day;
            }) : [];
            
            // Build modal content
            let content = `
                <div class="modal-date">${formattedDate}</div>
                <div class="modal-day">${dayName}</div>
            `;
            
            // Weather section
            if (weather) {
                content += `
                    <div class="modal-section">
                        <div class="modal-section-title">üå§Ô∏è Weather</div>
                        <div class="modal-weather-large">
                            <div class="modal-weather-icon">${weather.emoji}</div>
                            <div>
                                <div class="modal-weather-temp">${weather.temp}¬∞C</div>
                                <div class="modal-weather-desc">${weather.description}</div>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            // Birthdays section
            if (dayBirthdays.length > 0) {
                content += `<div class="modal-section">
                    <div class="modal-section-title">üéÇ Birthdays</div>`;
                dayBirthdays.forEach(birthday => {
                    const age = calculateAge(birthday.date);
                    content += `
                        <div class="modal-birthday-item">
                            <div class="modal-birthday-name">${birthday.name}</div>
                            <div class="modal-birthday-age">Turning ${age}</div>
                        </div>
                    `;
                });
                content += `</div>`;
            }
            
            // Events section
            if (dayEvents.length > 0) {
                content += `<div class="modal-section">
                    <div class="modal-section-title">üìÖ Events</div>`;
                dayEvents.forEach(event => {
                    const sourceBadge = event.source === 'calendar' 
                        ? '<span style="background: #34A853; color: white; padding: 3px 8px; border-radius: 6px; font-size: 0.75rem; margin-left: 8px;">üìÖ Google Calendar</span>'
                        : '';
                    content += `
                        <div class="modal-event-item">
                            <div class="modal-event-title">${event.title}${sourceBadge}</div>
                            ${event.time ? `<div class="modal-event-time">‚è∞ ${event.time}</div>` : '<div class="modal-event-time">All day</div>'}
                            ${event.description ? `<div class="modal-event-desc">${event.description}</div>` : ''}
                        </div>
                    `;
                });
                content += `</div>`;
            }
            
            // Show "nothing planned" if empty
            if (!weather && dayBirthdays.length === 0 && dayEvents.length === 0) {
                content += `<div class="modal-empty">Nothing planned for this day</div>`;
            }
            
            document.getElementById('modalContent').innerHTML = content;
            document.getElementById('dayModal').classList.add('active');
            document.body.style.overflow = 'hidden'; // Prevent background scrolling
        }
        
        function closeDayModal() {
            document.getElementById('dayModal').classList.remove('active');
            document.body.style.overflow = 'auto';
        }
        
        function closeModal(event) {
            if (event.target.classList.contains('modal-overlay')) {
                closeDayModal();
            }
        }
        
        // Routine Functions
        async function addRoutine(child) {
            const input = document.getElementById(`${child}Task`);
            const task = input.value.trim();
            if (!task) return alert('Please enter a task!');
            await apiCall('addRoutineTask', { child, task });
            input.value = '';
            loadRoutine(child);
        }
        
        async function toggleRoutineTask(child, index) {
            await apiCall('toggleRoutineTask', { child, index });
            loadRoutine(child);
        }
        
        async function loadRoutine(child) {
            const action = child === 'spencer' ? 'getSpencerRoutine' : 'getGraingerRoutine';
            const tasks = await apiCall(action);
            if (!tasks) return;
            
            const list = document.getElementById(`${child}Routine`);
            list.innerHTML = '';
            
            if (tasks.length === 0) {
                list.innerHTML = '<li class="loading">No tasks yet!</li>';
                return;
            }
            
            tasks.forEach(task => {
                const li = document.createElement('li');
                li.className = `routine-item ${task.completed ? 'completed' : ''}`;
                li.innerHTML = `
                    <div class="routine-text">${task.task}</div>
                    <button class="btn-complete ${task.completed ? 'completed' : ''}" 
                            onclick="toggleRoutineTask('${child}', ${task.index})">
                        ${task.completed ? '‚úì' : 'Done'}
                    </button>
                `;
                list.appendChild(li);
            });
        }
        
        // Birthday Functions
        async function addBirthday() {
            const name = document.getElementById('birthdayName').value.trim();
            const dateInput = document.getElementById('birthdayDate').value.trim();
            
            if (!name || !dateInput) return alert('Please enter name and date!');
            
            // Parse date - supports DD/MM/YYYY or YYYY-MM-DD
            let date;
            if (dateInput.includes('/')) {
                const parts = dateInput.split('/');
                if (parts.length === 3) {
                    // DD/MM/YYYY format
                    const day = parts[0].padStart(2, '0');
                    const month = parts[1].padStart(2, '0');
                    const year = parts[2];
                    date = `${year}-${month}-${day}`;
                } else {
                    return alert('Please use DD/MM/YYYY format (e.g., 15/03/1950)');
                }
            } else {
                date = dateInput; // Already in YYYY-MM-DD format
            }
            
            // Validate date
            const testDate = new Date(date);
            if (isNaN(testDate.getTime())) {
                return alert('Invalid date! Please use DD/MM/YYYY format (e.g., 15/03/1950)');
            }
            
            await apiCall('addBirthday', { name, date });
            document.getElementById('birthdayName').value = '';
            document.getElementById('birthdayDate').value = '';
            loadBirthdays();
            loadTodayEvents();
        }
        
        function getDaysUntil(dateStr) {
            const today = new Date();
            const birthday = new Date(dateStr);
            const thisYear = new Date(today.getFullYear(), birthday.getMonth(), birthday.getDate());
            if (thisYear < today) thisYear.setFullYear(today.getFullYear() + 1);
            return Math.ceil((thisYear - today) / (1000 * 60 * 60 * 24));
        }
        
        function calculateAge(dateStr) {
            const today = new Date();
            const birthDate = new Date(dateStr);
            let age = today.getFullYear() - birthDate.getFullYear();
            const monthDiff = today.getMonth() - birthDate.getMonth();
            
            // Check if birthday hasn't happened yet this year
            if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
                age--;
            }
            
            // If birthday is today or in the future this year, show next age
            const thisYearBirthday = new Date(today.getFullYear(), birthDate.getMonth(), birthDate.getDate());
            if (thisYearBirthday >= today) {
                age++;
            }
            
            return age;
        }
        
        async function loadBirthdays() {
            const birthdays = await apiCall('getBirthdays');
            if (!birthdays) return;
            
            const container = document.getElementById('birthdayList');
            container.innerHTML = '';
            
            if (birthdays.length === 0) {
                container.innerHTML = '<div style="grid-column: 1/-1; text-align: center; padding: 2rem; color: var(--text-tertiary);">No birthdays yet!</div>';
                return;
            }
            
            birthdays.sort((a, b) => getDaysUntil(a.date) - getDaysUntil(b.date));
            
            birthdays.forEach(birthday => {
                const days = getDaysUntil(birthday.date);
                const age = calculateAge(birthday.date);
                const div = document.createElement('div');
                div.className = 'birthday-card';
                div.innerHTML = `
                    <div class="birthday-countdown">${days === 0 ? 'üéâ TODAY! üéâ' : days === 1 ? '1 DAY' : `${days} DAYS`}</div>
                    <div class="birthday-name">${birthday.name}</div>
                    <div class="birthday-date">${new Date(birthday.date).toLocaleDateString('en-US', { month: 'long', day: 'numeric' })}</div>
                    <div style="font-size: 1.1rem; margin-top: 0.5rem; opacity: 0.95; position: relative; z-index: 1;">Turning ${age}</div>
                `;
                container.appendChild(div);
            });
        }
        
        // Initialize
        updateLeaderboard();
        loadPoints();
        loadTasks();
        loadShopping();
        loadTodayEvents();
        loadCalendar();
        loadRoutine('spencer');
        loadRoutine('grainger');
        loadBirthdays();
        fetchWeather();
        checkBirthdayAlerts();
        
        // Reset recurring tasks daily
        setInterval(async () => {
            await apiCall('resetRecurringTasks');
            loadTasks();
        }, 24 * 60 * 60 * 1000); // Once per day
        
        async function loadPoints() {
            const points = await apiCall('getPoints');
            if (points) {
                memberScores = points;
                let totalScore = 0;
                Object.values(points).forEach(p => totalScore += p);
                score = totalScore;
                document.getElementById('scoreValue').textContent = score;
                updateLeaderboard();
            }
        }
        
        async function checkBirthdayAlerts() {
            const birthdays = await apiCall('getBirthdays');
            if (!birthdays) return;
            
            const today = new Date();
            const oneWeekFromNow = new Date();
            oneWeekFromNow.setDate(today.getDate() + 7);
            
            const upcomingBirthdays = birthdays.filter(b => {
                const days = getDaysUntil(b.date);
                return days > 0 && days <= 7;
            });
            
            if (upcomingBirthdays.length > 0) {
                const alert = document.getElementById('birthdayAlert');
                const content = document.getElementById('birthdayAlertContent');
                alert.style.display = 'block';
                
                let html = '';
                upcomingBirthdays.forEach(birthday => {
                    const days = getDaysUntil(birthday.date);
                    const age = calculateAge(birthday.date);
                    html += `<div style="font-size: 1.1rem; margin-bottom: 0.5rem;"><strong>${birthday.name}'s</strong> birthday is in <strong>${days} day${days > 1 ? 's' : ''}</strong> (turning ${age})</div>`;
                });
                content.innerHTML = html;
            }
        }
    </script>
</body>
</html>
