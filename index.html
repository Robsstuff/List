<!DOCTYPE html>
<!-- saved from url=(0066)file:///C:/Users/DeDeDe/Downloads/family-organizer-COMPLETE_2.html -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Family Organizer - Complete</title>
    <style>
        :root {
            --primary: #1A5F7A;
            --primary-light: #2B7A9B;
            --primary-dark: #114356;
            --accent: #FF8B3D;
            --accent-light: #FFB26B;
            --success: #22C55E;
            --warning: #F59E0B;
            --danger: #EF4444;
            --bg-main: #F8FAFC;
            --bg-card: #FFFFFF;
            --bg-secondary: #F1F5F9;
            --text-primary: #0F172A;
            --text-secondary: #64748B;
            --text-tertiary: #94A3B8;
            --border: #E2E8F0;
            --shadow: 0 4px 6px -1px rgba(15, 23, 42, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(15, 23, 42, 0.1);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-main);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
        }
        .container { max-width: 1400px; margin: 0 auto; }
        
        header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            padding: 2rem;
            box-shadow: var(--shadow-lg);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        h1 { font-size: 2rem; font-weight: 700; color: white; margin-bottom: 0.5rem; }
        .subtitle { color: rgba(255, 255, 255, 0.8); font-size: 0.95rem; }
        .score-display {
            position: absolute;
            top: 2rem;
            right: 2rem;
            background: white;
            color: var(--primary);
            padding: 0.75rem 1.5rem;
            border-radius: 12px;
            font-weight: 700;
            font-size: 1.25rem;
            box-shadow: var(--shadow-lg);
        }
        .score-label { font-size: 0.7rem; opacity: 0.7; display: block; text-transform: uppercase; }
        
        .nav-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
            gap: 1rem;
            padding: 1.5rem 2rem;
            background: white;
            border-bottom: 1px solid var(--border);
        }
        .nav-btn {
            background: var(--bg-secondary);
            border: 2px solid transparent;
            color: var(--text-primary);
            padding: 0.875rem;
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }
        .nav-btn:hover { background: var(--bg-main); border-color: var(--primary); }
        .nav-btn.active { background: var(--primary); color: white; }
        
        .content-section { display: none; padding: 2rem; }
        .content-section.active { display: block; }
        .card {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 2rem;
            box-shadow: var(--shadow);
            margin-bottom: 1.5rem;
            border: 1px solid var(--border);
        }
        h2 { font-size: 1.5rem; font-weight: 700; margin-bottom: 1.5rem; }
        
        .input-group { display: flex; gap: 0.75rem; margin-bottom: 1.5rem; flex-wrap: wrap; }
        input, textarea, select {
            flex: 1;
            min-width: 160px;
            padding: 0.75rem 1rem;
            border: 2px solid var(--border);
            border-radius: 10px;
            font-family: inherit;
            font-size: 0.95rem;
            transition: all 0.2s;
        }
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(26, 95, 122, 0.1);
        }
        textarea { min-height: 80px; resize: vertical; }
        
        .btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 10px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            white-space: nowrap;
        }
        .btn:hover { background: var(--primary-light); transform: translateY(-1px); }
        .btn-accent { background: var(--accent); }
        .btn-accent:hover { background: var(--accent-light); }
        
        .todo-list, .shopping-list, .routine-list { list-style: none; }
        .todo-item, .shopping-item, .routine-item {
            background: var(--bg-card);
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 1.25rem;
            margin-bottom: 0.75rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
            transition: all 0.2s;
        }
        .todo-item:hover, .shopping-item:hover, .routine-item:hover {
            border-color: var(--primary);
            box-shadow: var(--shadow);
            transform: translateX(4px);
        }
        .todo-item.completed, .shopping-item.completed, .routine-item.completed {
            background: var(--bg-secondary);
            opacity: 0.6;
        }
        .todo-item.priority-high { border-left: 4px solid var(--danger); }
        .todo-item.priority-medium { border-left: 4px solid var(--warning); }
        .todo-item.priority-low { border-left: 4px solid #3B82F6; }
        
        .todo-text, .shopping-text, .routine-text { flex: 1; font-size: 1rem; font-weight: 500; }
        .todo-item.completed .todo-text,
        .shopping-item.completed .shopping-text,
        .routine-item.completed .routine-text {
            text-decoration: line-through;
            color: var(--text-tertiary);
        }
        
        .task-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-right: 0.5rem;
        }
        .badge-assignee { background: var(--primary); color: white; }
        .badge-priority-high { background: rgba(239, 68, 68, 0.1); color: var(--danger); border: 1px solid var(--danger); }
        .badge-priority-medium { background: rgba(245, 158, 11, 0.1); color: var(--warning); border: 1px solid var(--warning); }
        .badge-priority-low { background: rgba(59, 130, 246, 0.1); color: #3B82F6; border: 1px solid #3B82F6; }
        
        .btn-complete {
            background: var(--success);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.875rem;
            transition: all 0.2s;
        }
        .btn-complete:hover { background: #16A34A; }
        .btn-complete.completed { background: var(--text-tertiary); cursor: default; }
        
        .leaderboard-item {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 1rem 1.5rem;
            margin-bottom: 0.75rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .leaderboard-rank { font-size: 1.5rem; font-weight: 700; color: var(--accent); width: 40px; }
        .leaderboard-name { flex: 1; font-size: 1.1rem; font-weight: 600; }
        .leaderboard-score { font-size: 1.3rem; font-weight: 700; color: var(--primary); }
        .leaderboard-item.first {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 215, 0, 0.1));
            border: 2px solid #FFD700;
        }
        
        .calendar-event {
            background: var(--bg-secondary);
            border-left: 4px solid var(--accent);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }
        .event-title { font-size: 1.2rem; font-weight: 600; color: var(--primary); margin-bottom: 0.5rem; }
        .event-datetime { font-size: 0.95rem; color: var(--text-secondary); margin-bottom: 0.5rem; }
        .event-weather {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.4rem 1rem;
            background: rgba(255, 139, 61, 0.1);
            border-radius: 8px;
            font-size: 0.85rem;
            margin-top: 0.5rem;
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
        }
        .calendar-day {
            background: white;
            border: 2px solid var(--border);
            border-radius: 8px;
            min-height: 100px;
            padding: 8px;
            transition: all 0.2s;
        }
        .calendar-day:hover { border-color: var(--primary); box-shadow: var(--shadow); }
        .calendar-day.other-month { opacity: 0.3; }
        .calendar-day.today { border-color: var(--accent); border-width: 3px; background: rgba(255, 139, 61, 0.05); }
        .calendar-day-number { font-weight: 700; font-size: 1.1rem; margin-bottom: 5px; }
        .calendar-event-dot {
            background: var(--primary);
            color: white;
            padding: 3px 6px;
            border-radius: 4px;
            font-size: 0.7rem;
            margin-bottom: 3px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .birthday-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1rem;
        }
        .birthday-card {
            background: linear-gradient(135deg, var(--accent), var(--accent-light));
            color: white;
            border-radius: 16px;
            padding: 2rem;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        .birthday-card::before {
            content: 'üéÇ';
            position: absolute;
            top: -20px;
            right: -20px;
            font-size: 5rem;
            opacity: 0.2;
        }
        .birthday-countdown { font-size: 2rem; font-weight: 700; margin-bottom: 0.5rem; z-index: 1; position: relative; }
        .birthday-name { font-size: 1.4rem; font-weight: 700; margin-bottom: 0.5rem; z-index: 1; position: relative; }
        .birthday-date { font-size: 1rem; opacity: 0.9; z-index: 1; position: relative; }
        
        .points-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, var(--accent), var(--accent-light));
            color: white;
            padding: 2rem 3rem;
            border-radius: 20px;
            font-size: 2rem;
            font-weight: 700;
            box-shadow: var(--shadow-lg);
            animation: pointsEarned 1.5s ease-out forwards;
            z-index: 1000;
        }
        @keyframes pointsEarned {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
            50% { opacity: 1; transform: translate(-50%, -50%) scale(1.2); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(1); }
        }
        
        .loading { text-align: center; padding: 2rem; color: var(--text-tertiary); }
        
        @media (max-width: 768px) {
            header { padding: 1.5rem 1rem; }
            h1 { font-size: 1.5rem; }
            .score-display { position: static; margin-top: 1rem; display: inline-block; }
            .nav-buttons { grid-template-columns: repeat(2, 1fr); padding: 1rem; }
            .content-section { padding: 1rem; }
            .card { padding: 1.5rem; }
            .calendar-day { min-height: 80px; padding: 5px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Family Organizer</h1>
            <div class="subtitle">Rob, Jessie, Spencer &amp; Grainger</div>
            <div class="score-display">
                <span class="score-label">FAMILY POINTS</span>
                <span id="scoreValue">0</span>
            </div>
        </header>

        <div class="nav-buttons">
            <button class="nav-btn active" data-section="todo">üìù To-Do</button>
            <button class="nav-btn" data-section="shopping">üõí Shopping</button>
            <button class="nav-btn" data-section="calendar">üìÖ Calendar</button>
            <button class="nav-btn" data-section="routines">üë∂ Routines</button>
            <button class="nav-btn" data-section="birthdays">üéÇ Birthdays</button>
        </div>

        <!-- To-Do List -->
        <div class="content-section active" id="todo">
            <div class="card">
                <h2>To-Do List</h2>
                <div class="input-group">
                    <input type="text" id="newTask" placeholder="Enter a new task...">
                    <select id="taskAssignee">
                        <option value="">Assign to...</option>
                        <option value="Rob">Rob</option>
                        <option value="Jessie">Jessie</option>
                        <option value="Spencer">Spencer</option>
                        <option value="Grainger">Grainger</option>
                    </select>
                    <select id="taskPriority">
                        <option value="medium">Medium Priority</option>
                        <option value="high">High Priority</option>
                        <option value="low">Low Priority</option>
                    </select>
                    <button class="btn btn-accent" onclick="addTask()">Add Task</button>
                </div>
                <ul class="todo-list" id="todoList"><li class="todo-item completed priority-medium">
                    <div style="flex: 1;">
                        <div class="todo-text">Test Task</div>
                        <div style="margin-top: 0.5rem;"><span class="task-badge badge-priority-medium">Medium</span></div>
                    </div>
                    <button class="btn-complete completed" onclick="completeTask(0, &#39;&#39;)" disabled="">
                        ‚úì Done
                    </button>
                </li><li class="todo-item completed priority-medium">
                    <div style="flex: 1;">
                        <div class="todo-text">pizza</div>
                        <div style="margin-top: 0.5rem;"><span class="task-badge badge-priority-medium">Medium</span></div>
                    </div>
                    <button class="btn-complete completed" onclick="completeTask(1, &#39;&#39;)" disabled="">
                        ‚úì Done
                    </button>
                </li><li class="todo-item completed priority-medium">
                    <div style="flex: 1;">
                        <div class="todo-text">Test app</div>
                        <div style="margin-top: 0.5rem;"><span class="task-badge badge-priority-medium">Medium</span></div>
                    </div>
                    <button class="btn-complete completed" onclick="completeTask(2, &#39;&#39;)" disabled="">
                        ‚úì Done
                    </button>
                </li></ul>
            </div>

            <div class="card">
                <h2>üèÜ Family Leaderboard</h2>
                <div id="leaderboard"><div class="leaderboard-item first">
                    <div class="leaderboard-rank">ü•á</div>
                    <div class="leaderboard-name">Rob</div>
                    <div class="leaderboard-score">0 pts</div>
                </div><div class="leaderboard-item ">
                    <div class="leaderboard-rank">ü•à</div>
                    <div class="leaderboard-name">Jessie</div>
                    <div class="leaderboard-score">0 pts</div>
                </div><div class="leaderboard-item ">
                    <div class="leaderboard-rank">ü•â</div>
                    <div class="leaderboard-name">Spencer</div>
                    <div class="leaderboard-score">0 pts</div>
                </div><div class="leaderboard-item ">
                    <div class="leaderboard-rank">4.</div>
                    <div class="leaderboard-name">Grainger</div>
                    <div class="leaderboard-score">0 pts</div>
                </div></div>
            </div>
        </div>

        <!-- Shopping List -->
        <div class="content-section" id="shopping">
            <div class="card">
                <h2>Shopping List</h2>
                <div class="input-group">
                    <input type="text" id="newShoppingItem" placeholder="What do you need to buy?">
                    <button class="btn btn-accent" onclick="addShoppingItem()">Add Item</button>
                </div>
                <ul class="shopping-list" id="shoppingList"><li class="shopping-item ">
                    <div class="shopping-text">milk</div>
                    <div style="display: flex; gap: 0.5rem;">
                        <button class="btn-complete " onclick="toggleShoppingItem(0)">
                            ‚óã
                        </button>
                        
                    </div>
                </li></ul>
            </div>
        </div>

        <!-- Calendar -->
        <div class="content-section" id="calendar">
            <div class="card">
                <h2>Family Calendar</h2>
                
                <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem; justify-content: center;">
                    <button class="btn" id="listViewBtn" onclick="switchCalendarView(&#39;list&#39;)">üìã List View</button>
                    <button class="btn" id="gridViewBtn" onclick="switchCalendarView(&#39;grid&#39;)" style="background: var(--bg-secondary); color: var(--text-primary);">üìÖ Month View</button>
                </div>
                
                <div class="input-group">
                    <input type="text" id="eventTitle" placeholder="Event title">
                    <input type="date" id="eventDate">
                    <input type="time" id="eventTime">
                </div>
                <div class="input-group">
                    <textarea id="eventDescription" placeholder="Event description (optional)"></textarea>
                    <button class="btn btn-accent" onclick="addEvent()">Add Event</button>
                </div>
                
                <div id="calendarListView">
                    <div id="calendarEvents"><div class="calendar-event">
                    <div class="event-title">11222</div>
                    <div class="event-datetime">
                        üìÖ 01/06/2026
                    </div>
                    
                    
                </div><div class="calendar-event">
                    <div class="event-title">Test Event</div>
                    <div class="event-datetime">
                        üìÖ 12/12/2026
                    </div>
                    
                    
                </div></div>
                </div>
                
                <div id="calendarGridView" style="display: none;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <button class="btn" onclick="changeMonth(-1)">‚óÄ Prev</button>
                        <h3 id="currentMonth" style="margin: 0;">February 2026</h3>
                        <button class="btn" onclick="changeMonth(1)">Next ‚ñ∂</button>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; margin-bottom: 5px;">
                        <div style="text-align: center; font-weight: 600; padding: 10px; color: var(--text-secondary);">Sun</div>
                        <div style="text-align: center; font-weight: 600; padding: 10px; color: var(--text-secondary);">Mon</div>
                        <div style="text-align: center; font-weight: 600; padding: 10px; color: var(--text-secondary);">Tue</div>
                        <div style="text-align: center; font-weight: 600; padding: 10px; color: var(--text-secondary);">Wed</div>
                        <div style="text-align: center; font-weight: 600; padding: 10px; color: var(--text-secondary);">Thu</div>
                        <div style="text-align: center; font-weight: 600; padding: 10px; color: var(--text-secondary);">Fri</div>
                        <div style="text-align: center; font-weight: 600; padding: 10px; color: var(--text-secondary);">Sat</div>
                    </div>
                    
                    <div class="calendar-grid" id="calendarGrid"></div>
                </div>
            </div>
        </div>

        <!-- Kids Routines -->
        <div class="content-section" id="routines">
            <div class="card">
                <h2>Spencer's Routine</h2>
                <div class="input-group">
                    <input type="text" id="spencerTask" placeholder="Add task for Spencer">
                    <button class="btn btn-accent" onclick="addRoutine(&#39;spencer&#39;)">Add Task</button>
                </div>
                <ul class="routine-list" id="spencerRoutine"><li class="loading">No tasks yet!</li></ul>
            </div>

            <div class="card">
                <h2>Grainger's Routine</h2>
                <div class="input-group">
                    <input type="text" id="graingerTask" placeholder="Add task for Grainger">
                    <button class="btn btn-accent" onclick="addRoutine(&#39;grainger&#39;)">Add Task</button>
                </div>
                <ul class="routine-list" id="graingerRoutine"><li class="loading">No tasks yet!</li></ul>
            </div>
        </div>

        <!-- Birthdays -->
        <div class="content-section" id="birthdays">
            <div class="card">
                <h2>Family Birthdays</h2>
                <div class="input-group">
                    <input type="text" id="birthdayName" placeholder="Name">
                    <input type="date" id="birthdayDate">
                    <button class="btn btn-accent" onclick="addBirthday()">Add Birthday</button>
                </div>
                <div class="birthday-grid" id="birthdayList"><div class="birthday-card">
                    <div class="birthday-countdown">
                        110 DAYS
                    </div>
                    <div class="birthday-name">Rob Bukey</div>
                    <div class="birthday-date">
                        June 1
                    </div>
                </div></div>
            </div>
        </div>
    </div>

    <script>
        // Configuration - UPDATE THIS URL WITH YOUR DEPLOYED WEB APP URL
        const API_URL = 'https://script.google.com/macros/s/AKfycbyi7nxiLPP0E_1i3SfwqCFna80RJQCnZY9WhlalLewKVvXEHtlmXo1aYIspKmaj4-pp/exec';
        const WEATHER_API_KEY = 'd505edd7a0bf98a7a28bd658fa664f1d';
        const familyMembers = ['Rob', 'Jessie', 'Spencer', 'Grainger'];
        
        let score = 0;
        let memberScores = {};
        let weatherData = {};
        let currentMonth = new Date();
        let calendarEvents = [];
        
        familyMembers.forEach(member => memberScores[member] = 0);
        
        // API Call Function - WRITES AND READS FROM GOOGLE SHEETS
        async function apiCall(action, data = null) {
            try {
                let url = `${API_URL}?action=${action}`;
                if (data) {
                    url += `&data=${encodeURIComponent(JSON.stringify(data))}`;
                }
                
                const response = await fetch(url);
                const result = await response.json();
                
                if (result.error) {
                    console.error('API Error:', result.error);
                    return null;
                }
                
                return result;
            } catch (error) {
                console.error('Fetch error:', error);
                alert('Error connecting to Google Sheets. Check console for details.');
                return null;
            }
        }
        
        // Weather Functions
        function getWeatherEmoji(condition) {
            const c = condition.toLowerCase();
            if (c.includes('clear')) return '‚òÄÔ∏è';
            if (c.includes('cloud')) return c.includes('few') ? 'üå§Ô∏è' : '‚òÅÔ∏è';
            if (c.includes('rain')) return 'üåßÔ∏è';
            if (c.includes('thunder')) return '‚õàÔ∏è';
            if (c.includes('snow')) return 'üå®Ô∏è';
            if (c.includes('mist') || c.includes('fog')) return 'üå´Ô∏è';
            return 'üå§Ô∏è';
        }
        
        async function fetchWeather() {
            try {
                const location = await getUserLocation();
                const url = `https://api.openweathermap.org/data/2.5/forecast?lat=${location.lat}&lon=${location.lon}&appid=${WEATHER_API_KEY}&units=imperial`;
                const response = await fetch(url);
                const data = await response.json();
                
                const dailyForecasts = {};
                data.list.forEach(item => {
                    const date = new Date(item.dt * 1000);
                    const dateStr = date.toISOString().split('T')[0];
                    const hour = date.getHours();
                    if (!dailyForecasts[dateStr] || Math.abs(hour - 12) < Math.abs(new Date(dailyForecasts[dateStr].dt * 1000).getHours() - 12)) {
                        dailyForecasts[dateStr] = item;
                    }
                });
                
                weatherData = {};
                Object.keys(dailyForecasts).forEach(dateStr => {
                    const item = dailyForecasts[dateStr];
                    weatherData[dateStr] = {
                        temp: Math.round(item.main.temp),
                        condition: item.weather[0].main,
                        description: item.weather[0].description,
                        emoji: getWeatherEmoji(item.weather[0].main)
                    };
                });
                
                return weatherData;
            } catch (error) {
                console.error('Weather fetch error:', error);
                return {};
            }
        }
        
        async function getUserLocation() {
            return new Promise((resolve) => {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        pos => resolve({ lat: pos.coords.latitude, lon: pos.coords.longitude }),
                        () => resolve({ lat: -32.9719, lon: 151.6535 }) // Warners Bay, Lake Macquarie NSW
                    );
                } else {
                    resolve({ lat: -32.9719, lon: 151.6535 }); // Warners Bay, Lake Macquarie NSW
                }
            });
        }
        
        function getWeatherForDate(dateStr) {
            return weatherData[dateStr] || null;
        }
        
        // Navigation
        document.querySelectorAll('.nav-btn').forEach(btn => {
            btn.addEventListener('click', async () => {
                const section = btn.dataset.section;
                document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
                document.getElementById(section).classList.add('active');
                
                if (section === 'calendar' && Object.keys(weatherData).length === 0) {
                    await fetchWeather();
                    loadCalendar();
                }
            });
        });
        
        // Points & Leaderboard
        function updateScore(points, member = null) {
            score += points;
            document.getElementById('scoreValue').textContent = score;
            
            if (member && familyMembers.includes(member)) {
                memberScores[member] = (memberScores[member] || 0) + points;
                updateLeaderboard();
            }
            
            const popup = document.createElement('div');
            popup.className = 'points-popup';
            popup.textContent = `+${points} Points!`;
            document.body.appendChild(popup);
            setTimeout(() => popup.remove(), 1500);
        }
        
        function updateLeaderboard() {
            const leaderboard = document.getElementById('leaderboard');
            const sorted = familyMembers
                .map(member => ({ name: member, score: memberScores[member] || 0 }))
                .sort((a, b) => b.score - a.score);
            
            leaderboard.innerHTML = '';
            sorted.forEach((member, index) => {
                const emoji = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : `${index + 1}.`;
                const div = document.createElement('div');
                div.className = `leaderboard-item ${index === 0 ? 'first' : ''}`;
                div.innerHTML = `
                    <div class="leaderboard-rank">${emoji}</div>
                    <div class="leaderboard-name">${member.name}</div>
                    <div class="leaderboard-score">${member.score} pts</div>
                `;
                leaderboard.appendChild(div);
            });
        }
        
        // To-Do List
        async function addTask() {
            const input = document.getElementById('newTask');
            const assignee = document.getElementById('taskAssignee').value;
            const priority = document.getElementById('taskPriority').value;
            const task = input.value.trim();
            
            if (!task) return alert('Please enter a task!');
            
            await apiCall('addTask', { task, assignee, priority, addedDate: new Date().toISOString() });
            
            input.value = '';
            document.getElementById('taskAssignee').value = '';
            document.getElementById('taskPriority').value = 'medium';
            
            loadTasks();
        }
        
        async function completeTask(index, assignee) {
            await apiCall('completeTask', { index, completedDate: new Date().toISOString() });
            
            const points = 10 + Math.floor(Math.random() * 5) + 1;
            updateScore(points, assignee);
            loadTasks();
        }
        
        async function loadTasks() {
            const tasks = await apiCall('getTasks');
            if (!tasks) return;
            
            const list = document.getElementById('todoList');
            list.innerHTML = '';
            
            if (tasks.length === 0) {
                list.innerHTML = '<li class="loading">No tasks yet. Add your first task!</li>';
                return;
            }
            
            const priorityOrder = { high: 0, medium: 1, low: 2 };
            tasks.sort((a, b) => {
                if (a.completed !== b.completed) return a.completed ? 1 : -1;
                return (priorityOrder[a.priority] || 1) - (priorityOrder[b.priority] || 1);
            });
            
            tasks.forEach(task => {
                const li = document.createElement('li');
                li.className = `todo-item ${task.completed ? 'completed' : ''} priority-${task.priority || 'medium'}`;
                
                const badges = [];
                if (task.assignee) badges.push(`<span class="task-badge badge-assignee">${task.assignee}</span>`);
                if (task.priority) {
                    const p = task.priority.charAt(0).toUpperCase() + task.priority.slice(1);
                    badges.push(`<span class="task-badge badge-priority-${task.priority}">${p}</span>`);
                }
                
                li.innerHTML = `
                    <div style="flex: 1;">
                        <div class="todo-text">${task.task}</div>
                        ${badges.length ? `<div style="margin-top: 0.5rem;">${badges.join('')}</div>` : ''}
                    </div>
                    <button class="btn-complete ${task.completed ? 'completed' : ''}" 
                            onclick="completeTask(${task.index}, '${task.assignee || ''}')" 
                            ${task.completed ? 'disabled' : ''}>
                        ${task.completed ? '‚úì Done' : 'Complete'}
                    </button>
                `;
                list.appendChild(li);
            });
        }
        
        // Shopping List
        async function addShoppingItem() {
            const input = document.getElementById('newShoppingItem');
            const item = input.value.trim();
            
            if (!item) return alert('Please enter an item!');
            
            await apiCall('addShoppingItem', { item });
            input.value = '';
            loadShopping();
        }
        
        async function toggleShoppingItem(index) {
            await apiCall('toggleShoppingItem', { index });
            loadShopping();
        }
        
        async function deleteShoppingItem(index) {
            await apiCall('deleteShoppingItem', { index });
            loadShopping();
        }
        
        async function loadShopping() {
            const items = await apiCall('getShopping');
            if (!items) return;
            
            const list = document.getElementById('shoppingList');
            list.innerHTML = '';
            
            if (items.length === 0) {
                list.innerHTML = '<li class="loading">No items yet!</li>';
                return;
            }
            
            items.forEach(item => {
                const li = document.createElement('li');
                li.className = `shopping-item ${item.completed ? 'completed' : ''}`;
                li.innerHTML = `
                    <div class="shopping-text">${item.item}</div>
                    <div style="display: flex; gap: 0.5rem;">
                        <button class="btn-complete ${item.completed ? 'completed' : ''}" 
                                onclick="toggleShoppingItem(${item.index})">
                            ${item.completed ? '‚úì' : '‚óã'}
                        </button>
                        ${item.completed ? `<button class="btn-complete" style="background: var(--danger);" onclick="deleteShoppingItem(${item.index})">üóëÔ∏è</button>` : ''}
                    </div>
                `;
                list.appendChild(li);
            });
        }
        
        // Calendar
        async function addEvent() {
            const title = document.getElementById('eventTitle').value.trim();
            const date = document.getElementById('eventDate').value;
            const time = document.getElementById('eventTime').value;
            const description = document.getElementById('eventDescription').value.trim();
            
            if (!title || !date) return alert('Please enter title and date!');
            
            await apiCall('addEvent', { title, date, time, description, addedDate: new Date().toISOString() });
            
            document.getElementById('eventTitle').value = '';
            document.getElementById('eventDate').value = '';
            document.getElementById('eventTime').value = '';
            document.getElementById('eventDescription').value = '';
            
            loadCalendar();
        }
        
        async function loadCalendar() {
            const events = await apiCall('getEvents');
            if (!events) return;
            
            calendarEvents = events;
            
            // Load list view
            const container = document.getElementById('calendarEvents');
            container.innerHTML = '';
            
            if (events.length === 0) {
                container.innerHTML = '<div class="loading">No events yet!</div>';
                return;
            }
            
            events.sort((a, b) => new Date(a.date) - new Date(b.date));
            
            events.forEach(event => {
                const dateStr = event.date.split('T')[0];
                const weather = getWeatherForDate(dateStr);
                
                const div = document.createElement('div');
                div.className = 'calendar-event';
                
                let weatherHTML = '';
                if (weather) {
                    weatherHTML = `
                        <div class="event-weather">
                            <span>${weather.emoji}</span>
                            <span style="font-weight: 600;">${weather.temp}¬∞F</span>
                            <span>${weather.description}</span>
                        </div>
                    `;
                }
                
                // Show source badge
                const sourceBadge = event.source === 'calendar' 
                    ? '<span style="background: #34A853; color: white; padding: 3px 8px; border-radius: 6px; font-size: 0.75rem; margin-left: 8px;">üìÖ Google Calendar</span>'
                    : '';
                
                div.innerHTML = `
                    <div class="event-title">${event.title}${sourceBadge}</div>
                    <div class="event-datetime">
                        üìÖ ${new Date(event.date).toLocaleDateString()}${event.time ? ` at ${event.time}` : ''}
                    </div>
                    ${event.description ? `<div style="margin-top: 0.5rem; color: var(--text-primary);">${event.description}</div>` : ''}
                    ${weatherHTML}
                `;
                container.appendChild(div);
            });
            
            // Update grid if active
            if (document.getElementById('calendarGridView').style.display !== 'none') {
                renderCalendarGrid();
            }
        }
        
        function switchCalendarView(view) {
            const listView = document.getElementById('calendarListView');
            const gridView = document.getElementById('calendarGridView');
            const listBtn = document.getElementById('listViewBtn');
            const gridBtn = document.getElementById('gridViewBtn');
            
            if (view === 'list') {
                listView.style.display = 'block';
                gridView.style.display = 'none';
                listBtn.style.background = 'var(--primary)';
                listBtn.style.color = 'white';
                gridBtn.style.background = 'var(--bg-secondary)';
                gridBtn.style.color = 'var(--text-primary)';
            } else {
                listView.style.display = 'none';
                gridView.style.display = 'block';
                listBtn.style.background = 'var(--bg-secondary)';
                listBtn.style.color = 'var(--text-primary)';
                gridBtn.style.background = 'var(--primary)';
                gridBtn.style.color = 'white';
                renderCalendarGrid();
            }
        }
        
        function changeMonth(direction) {
            currentMonth.setMonth(currentMonth.getMonth() + direction);
            renderCalendarGrid();
        }
        
        function renderCalendarGrid() {
            const year = currentMonth.getFullYear();
            const month = currentMonth.getMonth();
            
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                'July', 'August', 'September', 'October', 'November', 'December'];
            document.getElementById('currentMonth').textContent = `${monthNames[month]} ${year}`;
            
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const daysInPrevMonth = new Date(year, month, 0).getDate();
            
            const today = new Date();
            const isCurrentMonth = today.getMonth() === month && today.getFullYear() === year;
            const todayDate = today.getDate();
            
            const grid = document.getElementById('calendarGrid');
            grid.innerHTML = '';
            
            // Previous month days
            for (let i = firstDay - 1; i >= 0; i--) {
                const day = daysInPrevMonth - i;
                const cell = createDayCell(day, true, false);
                grid.appendChild(cell);
            }
            
            // Current month days
            for (let day = 1; day <= daysInMonth; day++) {
                const isToday = isCurrentMonth && day === todayDate;
                const cell = createDayCell(day, false, isToday, year, month);
                grid.appendChild(cell);
            }
            
            // Next month days
            const totalCells = grid.children.length;
            const remainingCells = 42 - totalCells;
            for (let day = 1; day <= remainingCells; day++) {
                const cell = createDayCell(day, true, false);
                grid.appendChild(cell);
            }
        }
        
        function createDayCell(day, isOtherMonth, isToday, year, month) {
            const cell = document.createElement('div');
            cell.className = `calendar-day ${isOtherMonth ? 'other-month' : ''} ${isToday ? 'today' : ''}`;
            
            let html = `<div class="calendar-day-number">${day}</div>`;
            
            if (!isOtherMonth && year !== undefined && month !== undefined) {
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                
                // Weather
                const weather = getWeatherForDate(dateStr);
                if (weather) {
                    html += `<div style="font-size: 0.75rem; margin-bottom: 5px; color: var(--text-secondary);">${weather.emoji} ${weather.temp}¬∞</div>`;
                }
                
                // Events
                const dayEvents = calendarEvents.filter(e => e.date && e.date.startsWith(dateStr));
                dayEvents.forEach(event => {
                    html += `<div class="calendar-event-dot" title="${event.title}${event.time ? ' at ' + event.time : ''}">${event.title}</div>`;
                });
            }
            
            cell.innerHTML = html;
            return cell;
        }
        
        // Kids Routines
        async function addRoutine(child) {
            const input = document.getElementById(`${child}Task`);
            const task = input.value.trim();
            
            if (!task) return alert('Please enter a task!');
            
            await apiCall('addRoutineTask', { child, task });
            input.value = '';
            loadRoutine(child);
        }
        
        async function toggleRoutineTask(child, index) {
            await apiCall('toggleRoutineTask', { child, index });
            loadRoutine(child);
        }
        
        async function loadRoutine(child) {
            const action = child === 'spencer' ? 'getSpencerRoutine' : 'getGraingerRoutine';
            const tasks = await apiCall(action);
            if (!tasks) return;
            
            const list = document.getElementById(`${child}Routine`);
            list.innerHTML = '';
            
            if (tasks.length === 0) {
                list.innerHTML = '<li class="loading">No tasks yet!</li>';
                return;
            }
            
            tasks.forEach(task => {
                const li = document.createElement('li');
                li.className = `routine-item ${task.completed ? 'completed' : ''}`;
                li.innerHTML = `
                    <div class="routine-text">${task.task}</div>
                    <button class="btn-complete ${task.completed ? 'completed' : ''}" 
                            onclick="toggleRoutineTask('${child}', ${task.index})">
                        ${task.completed ? '‚úì Done' : 'Complete'}
                    </button>
                `;
                list.appendChild(li);
            });
        }
        
        // Birthdays
        async function addBirthday() {
            const name = document.getElementById('birthdayName').value.trim();
            const date = document.getElementById('birthdayDate').value;
            
            if (!name || !date) return alert('Please enter name and date!');
            
            await apiCall('addBirthday', { name, date });
            
            document.getElementById('birthdayName').value = '';
            document.getElementById('birthdayDate').value = '';
            loadBirthdays();
        }
        
        function getDaysUntil(dateStr) {
            const today = new Date();
            const birthday = new Date(dateStr);
            const thisYear = new Date(today.getFullYear(), birthday.getMonth(), birthday.getDate());
            if (thisYear < today) thisYear.setFullYear(today.getFullYear() + 1);
            return Math.ceil((thisYear - today) / (1000 * 60 * 60 * 24));
        }
        
        async function loadBirthdays() {
            const birthdays = await apiCall('getBirthdays');
            if (!birthdays) return;
            
            const container = document.getElementById('birthdayList');
            container.innerHTML = '';
            
            if (birthdays.length === 0) {
                container.innerHTML = '<div style="grid-column: 1/-1; text-align: center; padding: 2rem; color: var(--text-tertiary);">No birthdays yet!</div>';
                return;
            }
            
            birthdays.sort((a, b) => getDaysUntil(a.date) - getDaysUntil(b.date));
            
            birthdays.forEach(birthday => {
                const days = getDaysUntil(birthday.date);
                const div = document.createElement('div');
                div.className = 'birthday-card';
                div.innerHTML = `
                    <div class="birthday-countdown">
                        ${days === 0 ? 'üéâ TODAY! üéâ' : days === 1 ? '1 DAY' : `${days} DAYS`}
                    </div>
                    <div class="birthday-name">${birthday.name}</div>
                    <div class="birthday-date">
                        ${new Date(birthday.date).toLocaleDateString('en-US', { month: 'long', day: 'numeric' })}
                    </div>
                `;
                container.appendChild(div);
            });
        }
        
        // Initialize Everything
        updateLeaderboard();
        loadTasks();
        loadShopping();
        loadCalendar();
        loadRoutine('spencer');
        loadRoutine('grainger');
        loadBirthdays();
        
        // Fetch weather
        fetchWeather().then(() => {
            console.log('Weather data loaded');
        }).catch(err => {
            console.error('Failed to load weather:', err);
        });
    </script>


</body></html>